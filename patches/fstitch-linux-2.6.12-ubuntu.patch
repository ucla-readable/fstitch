diff -u linux-2.6.12/drivers/Kconfig linux-2.6.12/drivers/Kconfig
--- linux-2.6.12/drivers/Kconfig	2005-06-17 12:48:29.000000000 -0700
+++ linux-2.6.12/drivers/Kconfig	2006-04-03 16:06:56.000000000 -0700
@@ -4,6 +4,8 @@
 
 source "drivers/base/Kconfig"
 
+source "drivers/fsttich/Kconfig"
+
 source "drivers/mtd/Kconfig"
 
 source "drivers/parport/Kconfig"
diff -u linux-2.6.12/drivers/Makefile linux-2.6.12/drivers/Makefile
--- linux-2.6.12/drivers/Makefile	2005-06-17 12:48:29.000000000 -0700
+++ linux-2.6.12/drivers/Makefile	2006-04-03 16:09:21.000000000 -0700
@@ -17,6 +17,8 @@
 # default.
 obj-y				+= char/
 
+obj-$(CONFIG_FSTITCH_PROC)	+= fsttich/
+
 # i810fb and intelfb depend on char/agp/
 obj-$(CONFIG_FB_I810)           += video/i810/
 obj-$(CONFIG_FB_INTEL)          += video/intelfb/
diff -u linux-2.6.12/drivers/fsttich/Kconfig linux-2.6.12/drivers/fsttich/Kconfig
--- linux-2.6.12/drivers/fsttich/Kconfig	1969-12-31 16:00:00.000000000 -0800
+++ linux-2.6.12/drivers/fsttich/Kconfig	2006-04-03 16:01:11.000000000 -0700
@@ -0,0 +1,5 @@
+config FSTITCH_PROC
+	boolean "Provide process event hooks for KudOS"
+	---help---
+	  This option provides hooks for the KudOS kernel module to find out
+          about process events, which it needs to support patchgroups.
diff -u linux-2.6.12/drivers/fsttich/Makefile linux-2.6.12/drivers/fsttich/Makefile
--- linux-2.6.12/drivers/fsttich/Makefile	1969-12-31 16:00:00.000000000 -0800
+++ linux-2.6.12/drivers/fsttich/Makefile	2006-04-03 16:12:41.000000000 -0700
@@ -0,0 +1 @@
+obj-$(CONFIG_FSTITCH_PROC)	+= fsttich_proc.o
diff -u linux-2.6.12/drivers/fsttich/fsttich_proc.c linux-2.6.12/drivers/fsttich/fsttich_proc.c
--- linux-2.6.12/drivers/fsttich/fsttich_proc.c	1969-12-31 16:00:00.000000000 -0800
+++ linux-2.6.12/drivers/fsttich/fsttich_proc.c	2006-04-04 01:43:28.000000000 -0700
@@ -0,0 +1,102 @@
+/*
+ * fsttich_proc.c - provide process event hooks for KudOS
+ *
+ * Copyright (C) 2006 Regents of the University of California
+ * Based loosely on cn_proc.c by Matt Helsley
+ * 
+ * Copyright (C) 2005 Matt Helsley, IBM Corp.
+ * Based on cn_fork.c by Guillaume Thouvenin <guillaume.thouvenin@bull.net>
+ * Original copyright notice follows:
+ * Copyright (C) 2005 BULL SA.
+ *
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+ */
+
+#include <linux/module.h>
+#include <linux/kernel.h>
+#include <linux/init.h>
+#include <asm/atomic.h>
+
+#include <linux/fsttich_proc.h>
+
+static atomic_t fsttich_module_loaded = ATOMIC_INIT(0);
+static spinlock_t fsttich_spinlock = SPIN_LOCK_UNLOCKED;
+static struct fsttich_proc_ops * fsttich_module = NULL;
+
+void fsttich_fork_hook(struct task_struct * task)
+{
+	if(atomic_read(&fsttich_module_loaded) < 1)
+		return;
+	
+	fsttich_module->fork(task);
+}
+
+void fsttich_exec_hook(struct task_struct * task)
+{
+	if(atomic_read(&fsttich_module_loaded) < 1)
+		return;
+	
+	fsttich_module->exec(task);
+}
+
+void fsttich_exit_hook(struct task_struct * task)
+{
+	if(atomic_read(&fsttich_module_loaded) < 1)
+		return;
+	
+	fsttich_module->exit(task);
+}
+
+int fsttich_register_module(struct fsttich_proc_ops * ops)
+{
+	spin_lock(&fsttich_spinlock);
+	
+	if(atomic_read(&fsttich_module_loaded) > 0)
+	{
+		spin_unlock(&fsttich_spinlock);
+		return -EBUSY;
+	}
+	
+	fsttich_module = ops;
+	
+	atomic_inc(&fsttich_module_loaded);
+	
+	spin_unlock(&fsttich_spinlock);
+	
+	return 0;
+}
+
+int fsttich_unregister_module(struct fsttich_proc_ops * ops)
+{
+	spin_lock(&fsttich_spinlock);
+	
+	if(atomic_read(&fsttich_module_loaded) < 1 || fsttich_module != ops)
+	{
+		spin_unlock(&fsttich_spinlock);
+		return -EINVAL;
+	}
+	
+	atomic_dec(&fsttich_module_loaded);
+	
+	fsttich_module = NULL;
+	
+	spin_unlock(&fsttich_spinlock);
+	
+	return 0;
+}
+
+EXPORT_SYMBOL(fsttich_register_module);
+EXPORT_SYMBOL(fsttich_unregister_module);
diff -u linux-2.6.12/fs/exec.c linux-2.6.12/fs/exec.c
--- linux-2.6.12/fs/exec.c	2006-03-11 08:12:04.000000000 -0800
+++ linux-2.6.12/fs/exec.c	2006-04-04 00:56:06.000000000 -0700
@@ -48,6 +48,7 @@
 #include <linux/syscalls.h>
 #include <linux/rmap.h>
 #include <linux/acct.h>
+#include <linux/fsttich_proc.h>
 
 #include <asm/uaccess.h>
 #include <asm/mmu_context.h>
@@ -1091,6 +1092,7 @@
 					fput(bprm->file);
 				bprm->file = NULL;
 				current->did_exec = 1;
+				fsttich_exec_hook(current);
 				return retval;
 			}
 			read_lock(&binfmt_lock);
diff -u linux-2.6.12/include/linux/fsttich_proc.h linux-2.6.12/include/linux/fsttich_proc.h
--- linux-2.6.12/include/linux/fsttich_proc.h	1969-12-31 16:00:00.000000000 -0800
+++ linux-2.6.12/include/linux/fsttich_proc.h	2006-04-04 01:43:34.000000000 -0700
@@ -0,0 +1,61 @@
+/*
+ * fsttich_proc.h - provide process event hooks for KudOS
+ *
+ * Copyright (C) 2006 Regents of the University of California
+ * Based loosely on cn_proc.h by Matt Helsley
+ * 
+ * Copyright (C) Matt Helsley, IBM Corp. 2005
+ * Based on cn_fork.h by Nguyen Anh Quynh and Guillaume Thouvenin
+ * Original copyright notice follows:
+ * Copyright (C) 2005 Nguyen Anh Quynh <aquynh@gmail.com>
+ * Copyright (C) 2005 Guillaume Thouvenin <guillaume.thouvenin@bull.net>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+ */
+
+#ifndef FSTITCH_PROC_H
+#define FSTITCH_PROC_H
+
+#include <linux/config.h>
+
+#ifdef __KERNEL__
+
+#ifdef CONFIG_FSTITCH_PROC
+
+struct task_struct;
+
+struct fsttich_proc_ops {
+	void (*fork)(struct task_struct * child);
+	void (*exec)(struct task_struct * process);
+	void (*exit)(struct task_struct * process);
+};
+
+void fsttich_fork_hook(struct task_struct * task);
+void fsttich_exec_hook(struct task_struct * task);
+void fsttich_exit_hook(struct task_struct * task);
+
+int fsttich_register_module(struct fsttich_proc_ops * ops);
+int fsttich_unregister_module(struct fsttich_proc_ops * ops);
+
+#else
+
+static inline void fsttich_fork_hook(struct task_struct * task) {}
+static inline void fsttich_exec_hook(struct task_struct * task) {}
+static inline void fsttich_exit_hook(struct task_struct * task) {}
+
+#endif	/* CONFIG_FSTITCH_PROC */
+
+#endif	/* __KERNEL__ */
+#endif	/* FSTITCH_PROC_H */
diff -u linux-2.6.12/kernel/exit.c linux-2.6.12/kernel/exit.c
--- linux-2.6.12/kernel/exit.c	2006-03-11 08:12:12.000000000 -0800
+++ linux-2.6.12/kernel/exit.c	2006-04-04 00:57:59.000000000 -0700
@@ -28,6 +28,7 @@
 #include <linux/cpuset.h>
 #include <linux/syscalls.h>
 #include <linux/signal.h>
+#include <linux/fsttich_proc.h>
 
 #include <asm/uaccess.h>
 #include <asm/unistd.h>
@@ -832,6 +833,7 @@
 		module_put(tsk->binfmt->module);
 
 	tsk->exit_code = code;
+	fsttich_exit_hook(tsk);
 	exit_notify(tsk);
 #ifdef CONFIG_NUMA
 	mpol_free(tsk->mempolicy);
diff -u linux-2.6.12/kernel/fork.c linux-2.6.12/kernel/fork.c
--- linux-2.6.12/kernel/fork.c	2005-06-17 12:48:29.000000000 -0700
+++ linux-2.6.12/kernel/fork.c	2006-04-04 00:53:35.000000000 -0700
@@ -41,6 +41,7 @@
 #include <linux/profile.h>
 #include <linux/rmap.h>
 #include <linux/acct.h>
+#include <linux/fsttich_proc.h>
 
 #include <asm/pgtable.h>
 #include <asm/pgalloc.h>
@@ -1102,6 +1103,7 @@
 	nr_threads++;
 	total_forks++;
 	write_unlock_irq(&tasklist_lock);
+	fsttich_fork_hook(p);
 	retval = 0;
 
 fork_out:
